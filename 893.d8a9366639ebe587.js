"use strict";(self.webpackChunkPortal=self.webpackChunkPortal||[]).push([[893],{3893:(Pt,M,a)=>{a.r(M),a.d(M,{RoleModule:()=>Ct});var x=a(9808),w=a(224),E=a(4253),g=a(9826),b=a(655),S=a(5101),r=a(3075),C=a(520),p=a(2062);class _{constructor(){this.id=p.i.empty,this.name="",this.moduleId="",this.description="",this.isSystemAdmin=!1,this.permissions=new Array,this.rolePermissions=new Array,this.createBy=""}}var A=a(9256),c=a(4987),t=a(5e3),d=a(3038),I=a(9224),v=a(7093),P=a(3489),U=a(8833),T=a(2368);function N(o,e){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"Please enter name "),t.qZA())}let h=class{constructor(e,i,s,n,m,f,y){this.fb=e,this.httpService=i,this.sessionService=s,this.router=n,this.activatedRoute=m,this.toastrService=f,this.actionService=y,this.createMode=!0}ngOnInit(){this.data=new _,this.initializeForm(this.data),this.inquiry=new S.U,this.initializeToolbar(),this.routerSubscription=this.activatedRoute.params.pipe((0,c.t)(this)).subscribe(e=>{this.data.id=e.id||"",this.data.id.length>0&&(this.createMode=!1,this.get())}),this.updateEventSubscription=this.actionService.toggleUpdateEvent.pipe((0,c.t)(this)).subscribe(e=>this.update(e)),this.createNewEventSubscription=this.actionService.toggleCreateEvent.pipe((0,c.t)(this)).subscribe(e=>this.createNew(e)),this.getEventSubscription=this.actionService.toggleGetEvent.pipe((0,c.t)(this)).subscribe(e=>{this.data.id=e,this.get()})}ngOnDestroy(){}initializeForm(e){this.form=this.fb.group({id:[e.id,[r.kI.required]],name:[e.name,[r.kI.required,r.kI.minLength(5),r.kI.maxLength(200)]],description:[e.description,[r.kI.maxLength(500)]],isSystemAdmin:[e.isSystemAdmin]}),this.form.statusChanges.pipe((0,c.t)(this)).subscribe(i=>{this.actionService.formDirty=!("string"!=typeof i||"valid"!==i.toLowerCase()||!this.form.touched)})}initializeToolbar(){const e=new A.P;e.showSave=!0,e.showNavigatebefore=!0,e.title="Profile Maintenance",e.navigatebeforeUrl="/accountmanagement/role/inquiry",this.actionService.setToolbarSettings(e)}get(){const e=this.data.id,i=(new C.LE).set("id",e);this.httpService.HttpGetWithParams(this.sessionService.urlSetting.accountManagementWebApiUrl+"role/get",i).subscribe(n=>{this.getSuccess(n)},n=>this.showError(n))}getSuccess(e){this.data=e.entity,this.actionService.entity=this.data,this.setFormControls(this.data)}showError(e){}setFormControls(e){const i=this.form;i.get("id").setValue(e.id),i.get("name").setValue(e.name),i.get("description").setValue(e.description),i.get("isSystemAdmin").setValue(e.isSystemAdmin)}getFormControls(){const e=this.form,i=new _;return i.id=e.get("id").value,i.name=e.get("name").value,i.description=e.get("description").value,i.isSystemAdmin=e.get("isSystemAdmin").value,i}createNew(e){const i=new _;this.initializeForm(i),this.form.reset(this.form.value),this.clearValidatorAndUpdateValidityFormGroup(this.form),this.form.markAsPristine()}clearValidatorAndUpdateValidityFormGroup(e){Object.keys(e.controls).forEach(i=>{e.get(i).clearValidators(),e.get(i).updateValueAndValidity()})}update(e){const i=this.getFormControls();let s="";i.id===p.i.empty?(s=this.sessionService.urlSetting.accountManagementWebApiUrl+"role/create",this.httpService.HttpPost(s,i).subscribe(n=>{this.updateSuccess(n)},n=>this.updateFailed(n))):(s=this.sessionService.urlSetting.accountManagementWebApiUrl+"role/update",this.httpService.HttpPost(s,i).subscribe(n=>{this.updateSuccess(n)},n=>this.updateFailed(n)))}updateSuccess(e){const i=e.entity;this.data.id=i.id,this.form.get("id").setValue(i.id),this.toastrService.ShowSuccessMessage(e.returnMessage[0]),this.form.markAsPristine(),this.actionService.formDirty=!1,this.createMode=!1}updateFailed(e){}};h.\u0275fac=function(e){return new(e||h)(t.Y36(r.qu),t.Y36(d.OE),t.Y36(d.mj),t.Y36(g.F0),t.Y36(g.gz),t.Y36(d._W),t.Y36(d.cw))},h.\u0275cmp=t.Xpm({type:h,selectors:[["app-role-maintenance"]],decls:18,vars:2,consts:[[1,"form-field-full",2,"overflow","hidden",3,"formGroup"],["fxLayout","row wrap","fxLayoutGap","20px grid"],["fxFlex","100","fxFlex.lt-md","100"],["matInput","","type","text","formControlName","name"],[4,"ngIf"],["matInput","","formControlName","description","rows","6"],["color","accent","formControlName","isSystemAdmin"]],template:function(e,i){1&e&&(t.TgZ(0,"mat-card")(1,"mat-card-content")(2,"form",0)(3,"div",1)(4,"div",2)(5,"mat-form-field")(6,"mat-label"),t._uU(7,"Name"),t.qZA(),t._UZ(8,"input",3),t.YNc(9,N,2,0,"mat-error",4),t.qZA()(),t.TgZ(10,"div",2)(11,"mat-form-field")(12,"mat-label"),t._uU(13,"Description"),t.qZA(),t._UZ(14,"textarea",5),t.qZA()(),t.TgZ(15,"div",2)(16,"mat-slide-toggle",6),t._uU(17," Is System Administrator "),t.qZA()()()()()()),2&e&&(t.xp6(2),t.Q6J("formGroup",i.form),t.xp6(7),t.Q6J("ngIf",i.form.get("name").invalid))},directives:[I.a8,I.dn,r._Y,r.JL,r.sg,v.xw,v.SQ,v.yH,P.KE,P.hX,U.Nt,r.Fj,r.JJ,r.u,x.O5,P.TO,T.Rr],styles:[""]}),h=(0,b.gn)([(0,c.c)()],h);var D=a(2802),R=a(2638),Y=a(2354);let Z=(()=>{class o{constructor(){this.open=!1,this.mediaMatcher=matchMedia("(max-width : 720px)")}ngOnInit(){}isScreenSmall(){return this.mediaMatcher.matches}toggleSearch(){}optionsEvent(i){}}return o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-role-layout"]],hostAttrs:[1,"demo-sidenav-app"],decls:7,vars:2,consts:[[1,"demo-sidenav-container"],["role","navigation",1,"sidenav",3,"opened","mode"],["startSnav",""],["role","region"],[3,"optionsEvent"]],template:function(i,s){1&i&&(t._UZ(0,"app-page-header"),t.TgZ(1,"mat-sidenav-container",0),t._UZ(2,"mat-sidenav",1,2),t.TgZ(4,"mat-sidenav-content",3),t._UZ(5,"router-outlet"),t.TgZ(6,"app-float-button",4),t.NdJ("optionsEvent",function(m){return s.optionsEvent(m)}),t.qZA()()()),2&i&&(t.xp6(2),t.Q6J("opened",s.open)("mode","side"))},directives:[D.q,R.TM,R.JX,R.Rh,g.lC,Y.u],styles:["",".demo-sidenav-app[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:absolute;top:0;bottom:0;left:0;right:0}.demo-sidenav-container[_ngcontent-%COMP%]{flex:1;overflow:hidden}.demo-sidenav-container-fixed[_ngcontent-%COMP%]{flex:none}h1.demo-sidenav-app-name[_ngcontent-%COMP%]{margin-left:8px}button.demo-sidenav-close[_ngcontent-%COMP%]{margin:20px}.demo-sidenav-filler[_ngcontent-%COMP%]{margin:100px 20px}"]}),o})();const J=function F(o,e){for(var i=-1,s=null==o?0:o.length;++i<s&&!1!==e(o[i],i,o););return o};var B=a(3693),L=a(9940);var j=a(4177);const W=function z(o,e){return((0,j.Z)(o)?J:B.Z)(o,function Q(o){return"function"==typeof o?o:L.Z}(e))};class q{constructor(){this.id=p.i.empty,this.roleId=p.i.empty,this.permissionId=p.i.empty,this.permission="",this.accessright=!1}}var l=a(4999),V=a(5113),k=a(7067),G=a(7423),$=a(5245),X=a(7238);function K(o,e){if(1&o&&t._UZ(0,"th",14),2&o){const i=t.oxw(2);t.ekj("display",i.showImg)}}function tt(o,e){if(1&o&&(t.TgZ(0,"td",15),t._UZ(1,"img",16),t.qZA()),2&o){const i=e.$implicit,s=t.oxw(2);t.ekj("display",s.showImg),t.xp6(1),t.Q6J("src",i.imageUrl,t.LSH)}}function et(o,e){1&o&&(t.TgZ(0,"th",14),t._uU(1),t.ALo(2,"uppercase"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"description")," "))}function it(o,e){if(1&o&&(t.TgZ(0,"td",15),t._uU(1),t.qZA()),2&o){const i=e.$implicit;t.xp6(1),t.hij(" ",i.description," ")}}function ot(o,e){1&o&&(t.TgZ(0,"th",14),t._uU(1),t.ALo(2,"uppercase"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"access right")," "))}function st(o,e){if(1&o&&(t.TgZ(0,"td",15),t._uU(1),t.qZA()),2&o){const i=e.$implicit;t.xp6(1),t.AsE(" ",i.totalAccessPermission,"/",i.totalPermission," ")}}function nt(o,e){1&o&&(t.TgZ(0,"th",14)(1,"div",17),t._uU(2),t.ALo(3,"uppercase"),t.qZA()()),2&o&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"actions")," "))}function at(o,e){if(1&o){const i=t.EpF();t.TgZ(0,"td",15)(1,"div",17)(2,"button",18)(3,"mat-icon",19),t.NdJ("click",function(){const m=t.CHM(i).$implicit;return t.oxw(2).getRolePermissionByModuleId(m.id)}),t._uU(4,"arrow_forward"),t.qZA()()()()}}function rt(o,e){1&o&&t._UZ(0,"tr",20)}function lt(o,e){1&o&&t._UZ(0,"tr",21)}function ct(o,e){if(1&o&&(t.TgZ(0,"div")(1,"div",2)(2,"table",3),t.ynx(3,4),t.YNc(4,K,1,2,"th",5),t.YNc(5,tt,2,3,"td",6),t.BQk(),t.ynx(6,7),t.YNc(7,et,3,3,"th",8),t.YNc(8,it,2,1,"td",9),t.BQk(),t.ynx(9,10),t.YNc(10,ot,3,3,"th",8),t.YNc(11,st,2,2,"td",9),t.BQk(),t.ynx(12,11),t.YNc(13,nt,4,3,"th",8),t.YNc(14,at,5,0,"td",9),t.BQk(),t.YNc(15,rt,1,0,"tr",12),t.YNc(16,lt,1,0,"tr",13),t.qZA()()()),2&o){const i=t.oxw();t.xp6(1),t.Q6J("defaultElevation",2),t.xp6(1),t.Q6J("dataSource",i.dataSource),t.xp6(13),t.Q6J("matHeaderRowDef",i.moduleInquiry.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",i.moduleInquiry.displayedColumns)}}function mt(o,e){1&o&&(t.TgZ(0,"th",14),t._uU(1," Description "),t.qZA())}function dt(o,e){if(1&o&&(t.TgZ(0,"td",15),t._uU(1),t.qZA()),2&o){const i=e.$implicit;t.xp6(1),t.hij(" ",i.description," ")}}function ht(o,e){1&o&&(t.TgZ(0,"th",14),t._uU(1," Permission Category "),t.qZA())}function ut(o,e){if(1&o&&(t.TgZ(0,"td",15),t._uU(1),t.qZA()),2&o){const i=e.$implicit;t.xp6(1),t.hij(" ",i.category," ")}}function pt(o,e){if(1&o){const i=t.EpF();t.TgZ(0,"th",14)(1,"div",17)(2,"mat-slide-toggle",32),t.NdJ("change",function(n){return t.CHM(i),t.oxw(2).onModuleAccessRightChange(n)}),t.qZA()()()}if(2&o){const i=t.oxw(2);t.xp6(2),t.Q6J("checked",i.totalPermission===i.totalAccessPermission&&i.totalPermission>0)}}function gt(o,e){if(1&o){const i=t.EpF();t.TgZ(0,"td",15)(1,"div",17)(2,"mat-slide-toggle",33),t.NdJ("change",function(n){const m=t.CHM(i),f=m.$implicit,y=m.$implicit;return t.oxw(2).onAccessRightChange(n,f,y)}),t.qZA()()()}if(2&o){const i=e.$implicit;t.xp6(2),t.Q6J("matTooltip",i.accessRight?"Activate":"Deactivate")("checked",i.accessRight)}}function ft(o,e){1&o&&t._UZ(0,"tr",20)}function vt(o,e){1&o&&t._UZ(0,"tr",21)}function yt(o,e){if(1&o){const i=t.EpF();t.TgZ(0,"div",22)(1,"div",23)(2,"div",24)(3,"button",25),t.NdJ("click",function(){return t.CHM(i),t.oxw().back()}),t.TgZ(4,"mat-icon",26),t._uU(5,"arrow_back"),t.qZA()(),t.TgZ(6,"span",27),t._uU(7),t.qZA()()()(),t.TgZ(8,"div",28)(9,"table",3),t.ynx(10,7),t.YNc(11,mt,2,0,"th",8),t.YNc(12,dt,2,1,"td",9),t.BQk(),t.ynx(13,29),t.YNc(14,ht,2,0,"th",8),t.YNc(15,ut,2,1,"td",9),t.BQk(),t.ynx(16,30),t.YNc(17,pt,3,1,"th",8),t.YNc(18,gt,3,2,"td",9),t.BQk(),t.YNc(19,ft,1,0,"tr",31),t.YNc(20,vt,1,0,"tr",13),t.qZA()()}if(2&o){const i=t.oxw();t.xp6(7),t.Oqu(i.module),t.xp6(1),t.Q6J("defaultElevation",2),t.xp6(1),t.Q6J("dataSource",i.dataSourcePermission),t.xp6(10),t.Q6J("matHeaderRowDef",i.permissionInquiry.displayedColumns)("matHeaderRowDefSticky",!0),t.xp6(1),t.Q6J("matRowDefColumns",i.permissionInquiry.displayedColumns)}}let u=class{constructor(e,i,s,n,m,f){this.actionService=e,this.httpService=i,this.toastrService=s,this.activatedRoute=n,this.sessionService=m,this.breakpointObserver=f,this.dataSource=new l.by,this.dataSourcePermission=new l.by,this.roleId="",this.moduleId="",this.toolbarModel=new A.P,this.loadPermission=!1,this.totalPermission=0,this.totalAccessPermission=0,this.showImg=!0,this.displayedColumnsArray=[{name:"description",display:"Permission description"},{name:"category",display:"Permission category"},{name:"accessRight",display:"Access right"}],this.updateEventSubscription=this.actionService.toggleUpdateEvent.pipe((0,c.t)(this)).subscribe(y=>this.update()),this.refereshEventSubscription=this.actionService.toggleRefreshEvent.pipe((0,c.t)(this)).subscribe(y=>this.getModuleByRoleId())}ngOnInit(){this.initializeSearch(),this.initializeToolbar();let e=JSON.parse(sessionStorage.getItem("module-config"));null!=e&&(this.moduleConfig=e),this.routerSubscription=this.activatedRoute.queryParams.pipe((0,c.t)(this)).subscribe(i=>{this.roleId=i.id||"",this.role=i.role||"",this.roleId.length>0&&this.getModuleByRoleId(),this.role.length>0&&(this.toolbarModel.title="Role Permission for "+this.role,this.actionService.setToolbarSettings(this.toolbarModel))}),this.breakpointObserver.observe(["(max-width: 959px)"]).pipe((0,c.t)(this)).subscribe(i=>{this.showImg=!!i.matches})}ngOnDestroy(){}initializeSearch(){this.moduleInquiry=new S.U,this.moduleInquiry.displayedColumns=["imageUrl","description","totalPermission","actions"],this.permissionInquiry=new S.U,this.permissionInquiry.displayedColumns=this.displayedColumnsArray.map(e=>e.name)}initializeToolbar(){this.toolbarModel.showNavigatebefore=!0,this.toolbarModel.showAdd=!1,this.toolbarModel.showSave=!0,this.toolbarModel.title="Role Permission",this.toolbarModel.navigatebeforeUrl="/accountmanagement/role/inquiry",this.actionService.setToolbarSettings(this.toolbarModel)}getModuleByRoleId(){const e=(new C.LE).set("id",this.roleId);this.httpService.HttpGetWithParams(this.sessionService.urlSetting.accountManagementWebApiUrl+"role/getModuleByRoleId",e).subscribe(s=>{this.getModuleSuccess(s)},s=>this.showError(s))}getModuleSuccess(e){this.dataSource.data=e.entity,this.dataSource.data.forEach(i=>{let s=this.moduleConfig.find(n=>n.name==i.module);i.imageUrl=s?s.img:""})}getRolePermissionByModuleId(e){this.moduleId="";const i=(new C.LE).set("moduleId",e).set("roleId",this.roleId);this.httpService.HttpGetWithParams(this.sessionService.urlSetting.accountManagementWebApiUrl+"role/getRolePermissionByModuleId",i).subscribe(n=>{this.getRolePermissionByModuleIdSuccess(n,e)},n=>{this.loadPermission=!1,this.showError(n)})}getRolePermissionByModuleIdSuccess(e,i){this.loadPermission=!0;let s=e.entity;this.totalAccessPermission=s.totalAccessPermission,this.totalPermission=s.totalPermission,this.module=s.description,this.moduleId=i,this.dataSourcePermission.data=s.permissions}showError(e){}getData(){const e=new _;e.id=this.roleId;const i=new Array;return this.dataSourcePermission.data.forEach(s=>{const n=new q;!0===s.accessRight&&(n.roleId=this.roleId,n.permissionId=s.id,n.accessright=s.accessRight,i.push(n))}),e.rolePermissions.push(...i),e}update(){if(this.roleId===p.i.empty||""===this.roleId||this.moduleId===p.i.empty||""===this.moduleId)return;const e=this.getData();e.id=this.roleId,e.moduleId=this.moduleId;let i="";i=this.sessionService.urlSetting.accountManagementWebApiUrl+"role/setPermission",this.httpService.HttpPost(i,e).subscribe(s=>{this.updateSuccess(s)},s=>this.updateFailed(s))}updateSuccess(e){this.actionService.formDirty=!1,this.toastrService.ShowSuccessMessage(e.returnMessage[0])}updateFailed(e){}sortData(e){this.moduleInquiry.currentPageNumber=1,this.moduleInquiry.sortDirection=e.direction,this.moduleInquiry.sortExpression=e.active,this.getModuleByRoleId()}onAccessRightChange(e,i,s){i.accessRight=e.checked,this.dataSourcePermission.data[s]=i,this.actionService.formDirty=!0}onModuleAccessRightChange(e){W(this.dataSourcePermission.data,function(i){i.accessRight=e.checked}),this.actionService.formDirty=!0}back(){this.getModuleByRoleId(),this.loadPermission=!1}};u.\u0275fac=function(e){return new(e||u)(t.Y36(d.cw),t.Y36(d.OE),t.Y36(d._W),t.Y36(g.gz),t.Y36(d.mj),t.Y36(V.Yg))},u.\u0275cmp=t.Xpm({type:u,selectors:[["app-role-permission"]],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["name",""],["appMaterialElevation","","raisedElevation","16",1,"matero-table-container",3,"defaultElevation"],["mat-table","",3,"dataSource"],["matColumnDef","imageUrl"],["mat-header-cell","",3,"display",4,"matHeaderCellDef"],["mat-cell","",3,"display",4,"matCellDef"],["matColumnDef","description","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","totalPermission"],["matColumnDef","actions","stickyEnd",""],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[3,"src"],[1,"allc"],["mat-icon-button",""],[3,"click"],["mat-header-row",""],["mat-row",""],["fxLayout","row","fxLayout.xs","column","fxLayoutAlign","space-between center"],[1,"matero-group-button"],["fxLayout","row","fxLayoutAlign","center center"],["mat-icon-button","",3,"click"],["aria-label","label"],[1,"f-s-14","f-w-100"],["appMaterialElevation","","raisedElevation","16",1,"matero-table-container",2,"height","calc(100vh - 150px)",3,"defaultElevation"],["matColumnDef","category"],["matColumnDef","accessRight","stickyEnd",""],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],[3,"checked","change"],[3,"matTooltip","checked","change"]],template:function(e,i){if(1&e&&(t.YNc(0,ct,17,4,"div",0),t.YNc(1,yt,21,6,"ng-template",null,1,t.W1O)),2&e){const s=t.MAs(2);t.Q6J("ngIf",!i.loadPermission)("ngIfElse",s)}},directives:[x.O5,k.F,l.BZ,l.w1,l.fO,l.ge,l.Dz,l.ev,G.lW,$.Hw,l.as,l.XQ,l.nj,l.Gk,v.xw,v.Wh,T.Rr,X.gM],pipes:[x.gd],styles:["img[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:30px}.display[_ngcontent-%COMP%]{display:none}.mat-column-imageUrl[_ngcontent-%COMP%]{flex:0 0 15%}.mat-column-description[_ngcontent-%COMP%]{flex:0 0 70%}.mat-column-totalPermission[_ngcontent-%COMP%]{flex:0 0 10%}.mat-column-actions[_ngcontent-%COMP%]{flex:0 0 5%}"]}),u=(0,b.gn)([(0,c.c)()],u);const xt=[{path:"",component:Z,children:[{path:"permission",component:u,data:{title:"Permission"}},{path:"maintenance",component:h}]}],St=[x.ez,(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[g.Bz.forChild(xt)],g.Bz]}),o})(),w.m,E.O];let Ct=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[...St]]}),o})()}}]);